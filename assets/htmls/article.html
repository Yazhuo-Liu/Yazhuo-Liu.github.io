<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Reading | Yazhuo Liu</title>

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../../assets/css/style.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <style>
    /* Tweaks for the reading page */
    body { font-family: "PingFang SC", "Microsoft YaHei", "Heiti SC", sans-serif; }
    
    #main {
      padding: 30px;
      min-height: 100vh;
    }

    .article-content {
      background: #fff;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
      max-width: 900px;
      margin: 0 auto;
      position: relative; /* For positioning context */
    }
    
    .article-content img { max-width: 100%; border-radius: 5px; margin: 20px 0; }
    .article-content blockquote { border-left: 4px solid #149ddd; padding-left: 15px; color: #666; font-style: italic; background: #f9f9f9; padding: 10px; }
    .article-content pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
    
    .mobile-nav-toggle { color: #149ddd; }

    /* Navigation Styles */
    .nav-btn-group {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    .chapter-select {
        max-width: 200px;
        display: inline-block;
    }
  </style>
</head>

<body>

  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="../../assets/img/profile-img.webp" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="../../index.html">Yazhuo Liu</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://www.linkedin.com/in/yazhuo-liu-321b45226/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
          <a href="https://github.com/Yazhuo-Liu" class="github"><i class="bx bxl-github"></i></a>
          <a href="https://www.facebook.com/yazhuo.liu.758" class="facebook"><i class="bx bxl-facebook"></i></a>
          <a href="https://www.instagram.com/yazhuo_liu/" class="instagram"><i class="bx bxl-instagram"></i></a>
          <a href="https://orcid.org/0000-0003-1160-1779" class="orcid"><i class="bx bxs-graduation"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="../../index.html#hero" class="nav-link"><i class="bx bx-home"></i> <span>Home</span></a></li>
          <li><a href="../../index.html#about" class="nav-link"><i class="bx bx-user"></i> <span>About</span></a></li>
          <li><a href="../../index.html#resume" class="nav-link"><i class="bx bx-file-blank"></i> <span>Resume</span></a></li>
          <li><a href="../../index.html#portfolio" class="nav-link"><i class="bx bx-book-content"></i> <span>Portfolio</span></a></li>
          <li><a href="../../index.html#writings" class="nav-link active"><i class="bx bx-pen"></i> <span>Writings & News</span></a></li>
          <li><a href="../../index.html#contact" class="nav-link"><i class="bx bx-envelope"></i> <span>Contact</span></a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    
    <div class="container article-content">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <a id="back-link" href="../../index.html#writings" class="btn btn-sm btn-outline-primary rounded-pill">
          <i class="bi bi-arrow-left"></i> <span id="back-text">Back to List</span>
        </a>

        <a id="top-next-link" href="#" class="btn btn-sm btn-outline-primary rounded-pill d-none">
          <span id="top-next-text">Next</span> <i class="bi bi-arrow-right"></i>
        </a>
      </div>

      <div id="content">
        <div class="text-center mt-5">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-2 text-muted">Loading content...</p>
        </div>
      </div>

      <div id="bottom-nav" class="nav-btn-group d-flex flex-wrap justify-content-between align-items-center d-none">
        <a id="prev-chapter-btn" href="#" class="btn btn-sm btn-outline-secondary rounded-pill mb-2">
            <i class="bi bi-chevron-left"></i> Previous
        </a>

        <div class="mb-2">
            <select id="chapter-selector" class="form-select form-select-sm chapter-select" aria-label="Chapter Select">
                </select>
        </div>

        <a id="next-chapter-btn" href="#" class="btn btn-sm btn-outline-secondary rounded-pill mb-2">
            Next <i class="bi bi-chevron-right"></i>
        </a>
      </div>

    </div>

  </main>

  <script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/main.js"></script>

  <script>
    // ====================================================
    // CONFIGURATION: Novel Chapter Structure
    // ====================================================
    // Define the reading order here.
    // 'path': needs to match the 'src' parameter used in URL relative to the root or consistent with usage.
    // 'title': Display name for the dropdown.
    const novelChapters = [
      { 
        path: 'assets/docs/novel/A_index.md', 
        title: '目录 / Index' 
      },
      { 
        path: 'assets/docs/novel/chap1.md', 
        title: '第1章 云开见月' 
      },
      { 
        path: 'assets/docs/novel/chap2.md', 
        title: '第2章 云开见月' 
      },
      // Add more chapters here in the future, e.g.:
      // { path: 'assets/docs/novel/chap2.md', title: '第2章 ...' }
    ];

    // ====================================================
    // PART 1: Markdown Loading Logic
    // ====================================================
    const urlParams = new URLSearchParams(window.location.search);
    const fileSrc = urlParams.get('src');
    const contentDiv = document.getElementById('content');

    // Normalization helper: ensure path matches the format in novelChapters (remove leading ../ or /)
    function normalizePath(p) {
        if (!p) return '';
        // Remove ../ or ./ at the beginning until clean
        return p.replace(/^(\.\.\/)+/, '').replace(/^(\.\/)+/, '');
    }

    if (fileSrc) {
      let fetchPath = fileSrc;
      // Path correction for fetching
      if (!fileSrc.startsWith('..') && !fileSrc.startsWith('http')) {
        fetchPath = '../../' + fileSrc;
      }

      fetch(fetchPath)
        .then(response => {
          if (!response.ok) throw new Error("File not found: " + fetchPath);
          return response.text();
        })
        .then(text => {
          contentDiv.innerHTML = marked.parse(text);
          // Initialize Navigation after content is loaded
          initNavigation(normalizePath(fileSrc));
        })
        .catch(err => {
          contentDiv.innerHTML = `<div class="alert alert-danger">Error loading article.<br><small>${err.message}</small></div>`;
        });
    } else {
      contentDiv.innerHTML = '<div class="alert alert-warning">No article source specified.</div>';
    }

    // ====================================================
    // PART 2: Smart Navigation Logic
    // ====================================================
    
    // 1. Back Button Logic (Existing)
    const backLink = document.getElementById('back-link');
    const backText = document.getElementById('back-text');
    if (window.history.length > 1) {
      backLink.href = "javascript:history.back()";
      if(backText) backText.innerText = "Return";
    }

    // 2. Novel Navigation System (New)
    function initNavigation(currentPath) {
        const currentIndex = novelChapters.findIndex(ch => normalizePath(ch.path) === currentPath);
        
        // If the current file is not in our novel list, likely a standalone article
        if (currentIndex === -1) return; 

        const topNextLink = document.getElementById('top-next-link');
        const topNextText = document.getElementById('top-next-text');
        const bottomNav = document.getElementById('bottom-nav');
        const prevBtn = document.getElementById('prev-chapter-btn');
        const nextBtn = document.getElementById('next-chapter-btn');
        const chapterSelect = document.getElementById('chapter-selector');

        // Show nav elements
        bottomNav.classList.remove('d-none');
        topNextLink.classList.remove('d-none');

        // Helper to generate link
        const getLink = (path) => `article.html?src=${path}`;

        // --- Logic for NEXT (Top & Bottom) ---
        if (currentIndex < novelChapters.length - 1) {
            const nextChapter = novelChapters[currentIndex + 1];
            const nextUrl = getLink(nextChapter.path);
            
            // Top Button
            topNextLink.href = nextUrl;
            // If specifically on Index page, label it clearly
            if (currentIndex === 0) {
                topNextText.innerText = "Start Reading"; // Or "Chapter 1"
            } else {
                topNextText.innerText = "Next";
            }

            // Bottom Button
            nextBtn.href = nextUrl;
            nextBtn.classList.remove('disabled');
        } else {
            // Last chapter
            topNextLink.classList.add('disabled');
            topNextLink.classList.add('d-none'); // Hide top next if finished
            nextBtn.classList.add('disabled');
            nextBtn.innerText = "End";
        }

        // --- Logic for PREVIOUS (Bottom) ---
        if (currentIndex > 0) {
            const prevChapter = novelChapters[currentIndex - 1];
            prevBtn.href = getLink(prevChapter.path);
            prevBtn.classList.remove('disabled');
        } else {
            // First chapter (or Index)
            prevBtn.classList.add('disabled');
        }

        // --- Logic for Dropdown Selector ---
        novelChapters.forEach((ch, idx) => {
            const option = document.createElement('option');
            option.value = getLink(ch.path);
            option.text = ch.title;
            if (idx === currentIndex) {
                option.selected = true;
            }
            chapterSelect.appendChild(option);
        });

        // Dropdown change event
        chapterSelect.addEventListener('change', function() {
            if (this.value) {
                window.location.href = this.value;
            }
        });
    }

  </script>

</body>
</html>