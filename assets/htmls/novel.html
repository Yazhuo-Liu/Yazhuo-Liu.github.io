<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Reading | Yazhuo Liu</title>
  <meta name="description" content="Read original fiction by Yazhuo Liu (刘亚卓), including the novel '三年三十天 (3 years 30 days)'.">
  <meta name="keywords" content="Yazhuo Liu novel, 三年三十天, original fiction, 刘亚卓 写作">
  <meta name="author" content="Yazhuo Liu">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

  <link rel="canonical" href="https://yazhuoliu.com/assets/htmls/novel.html" />
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://yazhuoliu.com/assets/htmls/novel.html">
  <meta property="og:title" content="Reading | Yazhuo Liu">
  <meta property="og:description" content="Read original fiction by Yazhuo Liu (刘亚卓), including the novel '三年三十天 (3 years 30 days)'.">
  <meta property="og:image" content="https://yazhuoliu.com/assets/img/yazhuo-liu-profile.webp">
  <meta property="og:image:alt" content="Portrait of Yazhuo Liu">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Reading | Yazhuo Liu">
  <meta name="twitter:description" content="Read original fiction by Yazhuo Liu (刘亚卓).">
  <meta name="twitter:image" content="https://yazhuoliu.com/assets/img/yazhuo-liu-profile.webp">
  <meta name="twitter:image:alt" content="Portrait of Yazhuo Liu">

   <!-- Favicons -->
  <link href="../../assets/img/yazhuo-liu-profile.webp" rel="icon">
  <link href="../../assets/img/yazhuo-liu-profile.webp" rel="apple-touch-icon">


  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="../../assets/css/style.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <style>
    /* Tweaks for the reading page */
    body { font-family: "PingFang SC", "Microsoft YaHei", "Heiti SC", sans-serif; }
    
    #main {
      padding: 30px;
      min-height: 100vh;
    }

    .article-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      max-width: 100%;
      margin: 0 auto;
      position: relative; /* For positioning context */
    }
    
    .article-content img { max-width: 100%; border-radius: 5px; margin: 20px 0; }
    .article-content blockquote { border-left: 4px solid #149ddd; padding-left: 15px; color: #666; font-style: italic; background: #f9f9f9; padding: 10px; }
    .article-content pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }

    /* Navigation Styles */
    .nav-btn-group {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    .chapter-select {
        max-width: 200px;
        display: inline-block;
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PR8K6WLC14"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PR8K6WLC14');
  </script>

</head>

<body>

  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="../../assets/img/yazhuo-liu-profile.webp" alt="Portrait of Yazhuo Liu" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="../../index.html">Yazhuo Liu</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://www.linkedin.com/in/yazhuo-liu-321b45226/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
          <a href="https://github.com/Yazhuo-Liu" class="github"><i class="bx bxl-github"></i></a>
          <a href="https://www.facebook.com/yazhuo.liu.758" class="facebook"><i class="bx bxl-facebook"></i></a>
          <a href="https://www.instagram.com/yazhuo_liu/" class="instagram"><i class="bx bxl-instagram"></i></a>
          <a href="https://orcid.org/0000-0003-1160-1779" class="orcid"><i class="bx bxs-graduation"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="../../index.html#hero" class="nav-link"><i class="bx bx-home"></i> <span>Home</span></a></li>
          <li><a href="../../index.html#about" class="nav-link"><i class="bx bx-user"></i> <span>About</span></a></li>
          <li><a href="../../index.html#resume" class="nav-link"><i class="bx bx-file-blank"></i> <span>Resume</span></a></li>
          <li><a href="../../index.html#portfolio" class="nav-link"><i class="bx bx-book-content"></i> <span>Gallery</span></a></li>
          <li><a href="../../index.html#writings" class="nav-link active"><i class="bx bx-pen"></i> <span>Writings & Blogs</span></a></li>
          <li><a href="../../assets/htmls/music.html" class="nav-link"><i class="bx bx-music"></i> <span>My Songs</span></a></li>
          <li><a href="../../index.html#contact" class="nav-link"><i class="bx bx-envelope"></i> <span>Contact</span></a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    
    <div class="container-fluid article-content">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <a id="back-link" href="../../index.html#writings" class="btn btn-sm btn-outline-primary rounded-pill">
          <i class="bi bi-arrow-left"></i> <span id="back-text">Back to List</span>
        </a>

        <a id="top-next-link" href="#" class="btn btn-sm btn-outline-primary rounded-pill d-none">
          <span id="top-next-text">Next</span> <i class="bi bi-arrow-right"></i>
        </a>
      </div>

      <div id="content">
        <div class="text-center mt-5">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-2 text-muted">Loading content...</p>
        </div>
      </div>

      <div id="bottom-nav" class="nav-btn-group d-flex flex-wrap justify-content-between align-items-center d-none">
        <a id="prev-chapter-btn" href="#" class="btn btn-sm btn-outline-secondary rounded-pill mb-2">
            <i class="bi bi-chevron-left"></i> Previous
        </a>

        <div class="mb-2">
            <select id="chapter-selector" class="form-select form-select-sm chapter-select" aria-label="Chapter Select">
                </select>
        </div>

        <a id="next-chapter-btn" href="#" class="btn btn-sm btn-outline-secondary rounded-pill mb-2">
            Next <i class="bi bi-chevron-right"></i>
        </a>
      </div>

    </div>

  </main>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/main.js"></script>

  <script>
    // ====================================================
    // Chapter list: assets/docs/novel/chapters.json
    // Format: array of { "path": "...", "title": "..." } or just "path".
    // If title is omitted, it is read from the first "# Heading" line in the .md file.
    // ====================================================
    const urlParams = new URLSearchParams(window.location.search);
    const fileSrc = urlParams.get('src');
    const contentDiv = document.getElementById('content');
    const BASE = '../../';

    function normalizePath(p) {
      if (!p) return '';
      return p.replace(/^(\.\.\/)+/, '').replace(/^(\.\/)+/, '');
    }

    /** Extract title from md text: first line matching "# ..." (atx heading). */
    function titleFromMd(text) {
      const m = text.match(/^#+\s*(.+)$/m);
      return m ? m[1].trim() : null;
    }

    /** Fallback title from path (e.g. chap1.md -> chap1). */
    function fallbackTitle(path) {
      return path.replace(/^.*\//, '').replace(/\.md$/i, '');
    }

    (async function () {
      let novelChapters = [];
      try {
        const listRes = await fetch(BASE + 'assets/docs/novel/chapters.json');
        if (!listRes.ok) throw new Error('chapters.json not found');
        const raw = await listRes.json();
        const list = Array.isArray(raw) ? raw : (raw.chapters || []);
        novelChapters = list.map(ch => typeof ch === 'string' ? { path: ch } : { path: ch.path, title: ch.title });
        for (const ch of novelChapters) {
          if (ch.title) continue;
          const res = await fetch(BASE + ch.path);
          if (!res.ok) {
            ch.title = fallbackTitle(ch.path);
            continue;
          }
          const text = await res.text();
          ch.title = titleFromMd(text) || fallbackTitle(ch.path);
        }
      } catch (e) {
        contentDiv.innerHTML = '<div class="alert alert-danger">Failed to load chapter list.<br><small>' + (e.message || '') + '</small></div>';
        return;
      }

      if (fileSrc) {
        const fetchPath = (fileSrc.startsWith('..') || fileSrc.startsWith('http')) ? fileSrc : BASE + fileSrc;
        try {
          const res = await fetch(fetchPath);
          if (!res.ok) throw new Error('File not found: ' + fetchPath);
          let text = await res.text();
          if (text.includes('<!-- AUTO_CHAPTER_LIST -->')) {
            const listMd = novelChapters.map(ch =>
              '* [' + (ch.title || '').replace(/\]/g, '\\]') + '](novel.html?src=' + ch.path + ')'
            ).join('\n');
            text = text.replace('<!-- AUTO_CHAPTER_LIST -->', listMd);
          }
          contentDiv.innerHTML = marked.parse(text);
          initNavigation(normalizePath(fileSrc));
        } catch (err) {
          contentDiv.innerHTML = '<div class="alert alert-danger">Error loading novel.<br><small>' + (err.message || '') + '</small></div>';
        }
      } else {
        contentDiv.innerHTML = '<div class="alert alert-warning">No novel source specified.</div>';
      }

      // Back button: once on load
      const backLink = document.getElementById('back-link');
      const backText = document.getElementById('back-text');
      if (backLink && backText && window.history.length > 1) {
        backLink.href = 'javascript:history.back()';
        backText.innerText = 'Return';
      }

      function initNavigation(currentPath) {
        const currentIndex = novelChapters.findIndex(ch => normalizePath(ch.path) === currentPath);
        if (currentIndex === -1) return; 

        const topNextLink = document.getElementById('top-next-link');
        const topNextText = document.getElementById('top-next-text');
        const bottomNav = document.getElementById('bottom-nav');
        const prevBtn = document.getElementById('prev-chapter-btn');
        const nextBtn = document.getElementById('next-chapter-btn');
        const chapterSelect = document.getElementById('chapter-selector');

        // Show nav elements
        bottomNav.classList.remove('d-none');
        topNextLink.classList.remove('d-none');

        // Helper to generate link
        const getLink = (path) => `novel.html?src=${path}`;

        // --- Logic for NEXT (Top & Bottom) ---
        if (currentIndex < novelChapters.length - 1) {
            const nextChapter = novelChapters[currentIndex + 1];
            const nextUrl = getLink(nextChapter.path);
            
            // Top Button
            topNextLink.href = nextUrl;
            // If specifically on Index page, label it clearly
            if (currentIndex === 0) {
                topNextText.innerText = "Start Reading"; // Or "Chapter 1"
            } else {
                topNextText.innerText = "Next";
            }

            // Bottom Button
            nextBtn.href = nextUrl;
            nextBtn.classList.remove('disabled');
        } else {
            // Last chapter
            topNextLink.classList.add('disabled');
            topNextLink.classList.add('d-none'); // Hide top next if finished
            nextBtn.classList.add('disabled');
            nextBtn.innerText = "End";
        }

        // --- Logic for PREVIOUS (Bottom) ---
        if (currentIndex > 0) {
            const prevChapter = novelChapters[currentIndex - 1];
            prevBtn.href = getLink(prevChapter.path);
            prevBtn.classList.remove('disabled');
        } else {
            // First chapter (or Index)
            prevBtn.classList.add('disabled');
        }

        // --- Logic for Dropdown Selector ---
        novelChapters.forEach((ch, idx) => {
            const option = document.createElement('option');
            option.value = getLink(ch.path);
            option.text = ch.title;
            if (idx === currentIndex) {
                option.selected = true;
            }
            chapterSelect.appendChild(option);
        });

        // Dropdown change event
        chapterSelect.addEventListener('change', function() {
            if (this.value) {
                window.location.href = this.value;
            }
        });
      }
    })();
  </script>

    <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>Yazhuo Liu</span></strong>. All Rights Reserved.
      </div>
      <div class="credits">
        Powered by <strong><span>GitHub Pages</span></strong>
      </div>
    </div>
  </footer>

</body>
</html>
